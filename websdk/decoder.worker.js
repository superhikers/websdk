function Decoder(){this.logger=new Logger("Decoder"),this.coreLogLevel=0,this.wasmLoaded=!1,this.tmpReqQue=[],this.cacheBuffer=null,this.decodeTimer=null,this.videoCallback=null,this.audioCallback=null,this.packetCallback=null,this.eventCallback=null,this.decoderCmdCallback=null}self.Module={onRuntimeInitialized:function(){onWasmLoaded()},locateFile:function(e,o){return console.log("libffmpeg.wasm ==="+location.origin+self.name+e),location.origin+self.name+e}},self.importScripts("enumConstant.js","logger.js","libffmpeg.js"),Decoder.prototype.initDecoder=function(e,o,t,a,r){var s=Module._initDecoder(this.coreLogLevel,this.eventCallback,this.decoderCmdCallback,0);if(this.logger.logInfo("initDecoder return "+s+"."),console.log(t,a,r,"encrypt_type"),0==s){if(t&&""!=t&&a&&""!=a&&r&&""!=r){var c=allocateUTF8(t),l=allocateUTF8(a),n=allocateUTF8(r);Module._setCipherInfo(n,c,l)}null==this.cacheBuffer&&(this.cacheBuffer=Module._malloc(o),console.log(this.cacheBuffer,"this.cacheBuffer1")),Module._setPlayMode(e)}var d={t:common.kInitDecoderRsp,e:s};self.postMessage(d)},Decoder.prototype.uninitDecoder=function(){this.closeDecoder();var e=Module._uninitDecoder();this.logger.logInfo("Uninit ffmpeg decoder return "+e+"."),null!==this.cacheBuffer&&(Module._free(this.cacheBuffer),this.cacheBuffer=null,console.log("uninitDecoder"))},Decoder.prototype.getParam=function(e){var o,t,a,r,s,c,l,n,d,i,u=2002==e?3:4,g=Module._malloc(4*u),m=2002==e?Module._getAudioParam(g,u):Module._getVideoParam(g,u);this.logger.logInfo("getParam return "+m),0==m?(t=g>>2,a=Module.HEAP32.subarray(t,t+u),r=2002==e?"":a[0],s=2002==e?"":a[1],c=2002==e?"":a[2],l=2002==e?"":a[3],n=2002==e?a[0]:"",d=2002==e?a[1]:"",i=2002==e?a[2]:"",o={t:common.kGetParamRsp,e:m,type:2002==e?"audio":"video",v:{d:r,p:s,w:c,h:l},a:{f:n,c:d,r:i}},self.postMessage(o)):(o={t:common.kGetParamRsp,e:m},self.postMessage(o)),Module._free(g)},Decoder.prototype.openDecoder=function(e){var o,t=Module._openDecoder(this.videoCallback,this.audioCallback,void 0,this.packetCallback,e);this.logger.logInfo("openDecoder return "+t),0==t&&(o={t:common.kOpenDecoderRsp,e:t},self.postMessage(o))},Decoder.prototype.closeDecoder=function(){isGetParams=!1,isSendDataCallback=!1,this.logger.logInfo("closeDecoder."),this.decodeTimer&&(clearInterval(this.decodeTimer),this.decodeTimer=null,this.logger.logInfo("Decode timer stopped."));var e=Module._closeDecoder();this.logger.logInfo("Close ffmpeg decoder return "+e+".");var o={t:common.kCloseDecoderRsp,e:0};self.postMessage(o)},Decoder.prototype.startDecoding=function(e){this.logger.logInfo("Start decoding."),this.decodeTimer&&clearInterval(this.decodeTimer),this.decodeTimer=setInterval(this.decode,e)},Decoder.prototype.pauseDecoding=function(){this.logger.logInfo("Pause decoding."),this.decodeTimer&&(clearInterval(this.decodeTimer),this.decodeTimer=null)};var isGetParams=!1;let a1=0;Decoder.prototype.decode=function(){var e=Module._malloc(4),o=Module._decodeOnePacket(e);for(7==o&&self.decoder.logger.logInfo("Decoder finished."),0==o&&(isGetParams=!0);9==o&&this.decodeTimer;)o=Module._decodeOnePacket(e);Module._free(e)},Decoder.prototype.sendData=function(e){var o=new Uint8Array(e);Module.HEAPU8.set(o,this.cacheBuffer),Module._sendData(this.cacheBuffer,o.length),o=null},Decoder.prototype.getSetPlayBackSpeedReq=function(e){var o,t,a,r,s,c=Module._malloc(4),l=Module._malloc(1024),n=allocateUTF8(e),d=Module._getSetPlayBackSpeedReq(l,c,1024,n);this.logger.logInfo("_getSetPlayBackSpeedReq return "+d),0==d&&(t=c>>2,a=Module.HEAP32.subarray(t,t+1)[0],r=Module.HEAPU8.subarray(l,l+a),s=new Uint8Array(r),o={t:common.getSetPlayBackSpeedReq,b:s},self.postMessage(o),s=null),Module._free(c),Module._free(l)},Decoder.prototype.getSetPlayBackStartReq=function(){var e,o,t,a,r,s=Module._malloc(4),c=Module._malloc(1024),l=Module._getSetPlayBackStartReq(c,s,1024);this.logger.logInfo("_getSetPlayBackStartReq return "+l),0==l&&(o=s>>2,t=Module.HEAP32.subarray(o,o+1)[0],a=Module.HEAPU8.subarray(c,c+t),r=new Uint8Array(a),e={t:common.getSetPlayBackStartReq,b:r},self.postMessage(e)),Module._free(s),Module._free(c)},Decoder.prototype.getSetPlayBackStartTimeReq=function(e){var o,t,a,r,s,c=Module._malloc(4),l=Module._malloc(1024),n=allocateUTF8(String(e)),d=Module._getSetPlayBackStartTimeReq(l,c,1024,n);this.logger.logInfo("_getSetPlayBackStartTimeReq return "+d),0==d&&(t=c>>2,a=Module.HEAP32.subarray(t,t+1)[0],r=Module.HEAPU8.subarray(l,l+a),s=new Uint8Array(r),o={t:common.getSetPlayBackStartTimeReq,b:s},self.postMessage(o)),Module._free(c),Module._free(l)},Decoder.prototype.getHeartbeatPing=function(){var e,o,t,a,r,s=Module._malloc(4),c=Module._malloc(1024),l=Module._getHeartbeatPing(c,s,1024);this.logger.logInfo("_getHeartbeatPing return "+l),0==l&&(o=s>>2,t=Module.HEAP32.subarray(o,o+1)[0],a=Module.HEAPU8.subarray(c,c+t),r=new Uint8Array(a),e={t:common.getHeartBeatRequest,b:r,l:t},self.postMessage(e)),Module._free(s),Module._free(c)},Decoder.prototype.getHandsharkReq=function(){var e,o,t,a,r,s=Module._malloc(4),c=Module._malloc(1024),l=Module._getHandsharkReq(c,s,1024);this.logger.logInfo("_getHeartbeatPing return "+l),0==l&&(o=s>>2,t=Module.HEAP32.subarray(o,o+1)[0],a=Module.HEAPU8.subarray(c,c+t),r=new Uint8Array(a),e={t:common.getHandsharkRes,b:r,l:t},self.postMessage(e)),Module._free(s),Module._free(c)},Decoder.prototype.processReq=function(e){switch(e.t){case common.kInitDecoderReq:this.initDecoder(e.s,e.c,e.k,e.i,e.ct);break;case common.kUninitDecoderReq:this.uninitDecoder();break;case common.kOpenDecoderReq:this.openDecoder(e.isBareStream);break;case common.kCloseDecoderReq:this.closeDecoder();break;case common.kStartDecodingReq:this.startDecoding(e.i);break;case common.kPauseDecodingReq:this.pauseDecoding();break;case common.kFeedDataReq:this.sendData(e.d);break;case common.getHeartBeatRequest:this.getHeartbeatPing();break;case common.resetDecoderFifo:this.resetDecoderFifo();break;case common.getSetPlayBackSpeedReq:this.getSetPlayBackSpeedReq(e.l);break;case common.getSetPlayBackStartReq:this.getSetPlayBackStartReq();break;case common.getSetPlayBackStartTimeReq:this.getSetPlayBackStartTimeReq(e.s);break;case common.getHandsharkReq:this.getHandsharkReq();break;default:this.logger.logError("Unsupport messsage "+e.t)}},Decoder.prototype.cacheReq=function(e){e&&this.tmpReqQue.push(e)},Decoder.prototype.resetDecoderFifo=function(e){Module._resetDecoderFifo()};var isSendDataCallback=!1;function onWasmLoaded(){self.decoder?self.decoder.onWasmLoaded():console.log("[ER] No decoder!")}Decoder.prototype.onWasmLoaded=function(){this.logger.logInfo("Wasm loaded."),this.wasmLoaded=!0,this.videoCallback=Module.addFunction((function(e,o,t){var a=Module.HEAPU8.subarray(e,e+o),r=new Uint8Array(a),s={t:common.kVideoFrame,s:t,d:r};self.postMessage(s,[s.d.buffer]),r=null}),"viid"),this.audioCallback=Module.addFunction((function(e,o,t){var a=Module.HEAPU8.subarray(e,e+o),r=new Uint8Array(a),s={t:common.kAudioFrame,s:t,d:r};self.postMessage(s,[s.d.buffer]),r=null}),"viid"),this.packetCallback=Module.addFunction((function(e,o,t,a,r,s,c){var l=Module.HEAPU8.subarray(o,o+t),n=new Uint8Array(l),d=UTF8ToString(s,c),i={t:common.bareStream,uint8ArrayStreamData:n,type:e,size:t,info:d,pts:a,dts:r};self.postMessage(i,[i.uint8ArrayStreamData.buffer])}),"viiiddii"),this.decoderCmdCallback=Module.addFunction((function(e,o,t,a,r,s,c){var l,n,d,i,u;switch(e){case 1:i={t:common.deviceReady},self.postMessage(i);break;case 2:break;case 3:d={t:common.responseCurDateTime,d:r},self.postMessage(d);break;case 4:break;case 8:n=UTF8ToString(s,c),l={t:common.playbakcRecordList,d:n},self.postMessage(l);break;case 9:u={t:common.heartPingResp},self.postMessage(u)}}),"vijiijii");const e=this;this.eventCallback=Module.addFunction((function(o,t){if(o>=4&&o<=18){const e={t:common.serverDecoderError,s:o};self.postMessage(e)}switch(o){case 0:if(!isSendDataCallback){const e={t:common.sendDataCallback};self.postMessage(e),isSendDataCallback=!0}break;case 1:case 2:case 3:const t={t:common.socketLinkState,s:o};self.postMessage(t);break;case 2e3:const a={t:common.eventTypeFifoFull};self.postMessage(a);break;case 2001:const r={t:common.eventTypeFifoEnough};self.postMessage(r);break;case 2002:e.getParam(2002);break;case 2003:e.getParam(2003);break;case 17:const s={t:common.serverDataTimeout};self.postMessage(s);break;default:const c={t:common.serverDeviceUnLink,s:o};self.postMessage(c)}}),"vii");let o={t:common.onWasmLoaded};var t;for(self.postMessage(o);this.tmpReqQue.length>0;)t=this.tmpReqQue.shift(),this.processReq(t)},self.decoder=new Decoder,self.onmessage=function(e){if(self.decoder){var o=e.data;if(!self.decoder.wasmLoaded)return self.decoder.cacheReq(o),void self.decoder.logger.logInfo("Temp cache req "+o.t+".");self.decoder.processReq(o)}else console.log("[ER] Decoder not initialized!")};